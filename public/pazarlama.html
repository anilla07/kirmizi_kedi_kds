<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDS | Akƒ±llƒ± Pazarlama Analizi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f1f5f9; color: #0f172a; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .brand-red { background-color: #be123c; } 
        .sidebar-link { color: #94a3b8; transition: all 0.2s; }
        .sidebar-link:hover { color: white; background-color: rgba(255,255,255,0.05); }
        .sidebar-active { color: #be123c !important; font-weight: 700; background-color: rgba(190, 18, 60, 0.1); border-right: 3px solid #be123c; }
        .stat-card { background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); }
        .toggle-checkbox:checked { right: 0; border-color: #10b981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10b981; }
    </style>
</head>
<body class="flex h-screen">

    <aside class="w-64 bg-[#1e293b] flex flex-col flex-shrink-0 shadow-2xl z-50">
        <div class="p-6 border-b border-slate-700 bg-[#0f172a]">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 brand-red rounded flex items-center justify-center text-white"><i class="fa-solid fa-chart-pie"></i></div>
                <h1 class="text-white font-bold text-lg tracking-tight">Kƒ±rmƒ±zƒ± Kedi Kitabevi KDS</h1>
            </div>
        </div>
        <nav class="flex-1 mt-6 px-4 space-y-1 overflow-y-auto">
            <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 mt-2 italic">Mevcut Varlƒ±klar</p>
            <a href="subeler.html" class="flex items-center gap-3 px-3 py-3 text-sm rounded sidebar-link"><i class="fa-solid fa-store w-5 text-center"></i> ≈ûubelerim</a>
            <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 mt-6 italic">B√ºy√ºme Analizi</p>
            <a href="lokasyon.html" class="flex items-center gap-3 px-3 py-3 text-sm rounded sidebar-link"><i class="fa-solid fa-location-crosshairs w-5 text-center"></i> Lokasyon Analizi</a>
            <a href="talep.html" class="flex items-center gap-3 px-3 py-3 text-sm rounded sidebar-link"><i class="fa-solid fa-arrow-trend-up w-5 text-center"></i> Talep Analizi</a>
            <a href="pazarlama.html" class="flex items-center gap-3 px-3 py-3 text-sm rounded sidebar-link sidebar-active"><i class="fa-solid fa-bullseye w-5 text-center"></i> Pazarlama Stratejisi</a>
            <a href="envanter.html" class="flex items-center gap-3 px-3 py-3 text-sm rounded sidebar-link"><i class="fa-solid fa-warehouse w-5 text-center"></i> Envanter Y√∂netimi</a>
            
        </nav>
        <div class="p-4 bg-[#0f172a] border-t border-slate-700">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center text-white text-xs font-bold">YO</div>
                <div><p class="text-xs text-white font-bold">Y√∂netici Oturumu</p><p class="text-[10px] text-slate-400">Veritabanƒ±: Online</p></div>
            </div>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-10 bg-[#f8fafc]">
        
        <header class="mb-8 border-b border-slate-200 pb-6 flex justify-between items-end">
            <div>
                <h2 class="text-2xl font-extrabold text-slate-900 tracking-tight">Akƒ±llƒ± Pazarlama Analizi</h2>
                <p class="text-slate-500 mt-1 text-sm">≈ûube bazlƒ± m√º≈üteri segmentasyonu ve yapay zeka destekli en k√¢rlƒ± hedef √∂nerisi.</p>
            </div>
            <span class="px-3 py-1 bg-white border text-xs font-bold text-slate-500 rounded shadow-sm">Tablo: <span class="font-mono text-brand-red">kds_pazarlama_optimizasyon</span></span>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="stat-card p-6 flex flex-col h-fit bg-slate-50 border-slate-300">
                
                <div class="mb-4">
                    <label class="text-[10px] font-bold text-slate-500 uppercase mb-2 block flex items-center gap-2">
                        <i class="fa-solid fa-store text-brand-red"></i> Analiz Edilecek ≈ûube
                    </label>
<select id="branchSelect" class="w-full bg-white border border-slate-300 text-sm font-bold py-3 px-3 rounded shadow-sm outline-none focus:border-brand-red transition" onchange="analyzeBranch()">
    <option value="" disabled selected>≈ûubeler Y√ºkleniyor...</option>
</select>
                </div>

                <div class="mb-4 p-4 bg-white border border-slate-200 rounded shadow-sm">
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-3">Mevcut M√º≈üteri Daƒüƒ±lƒ±mƒ± (Top 3)</p>
                    <div id="segments-container" class="space-y-3">
                        </div>
                </div>

                <div class="bg-green-50 border border-green-200 p-4 rounded-lg mb-6">
    <div class="flex justify-between items-center mb-2">
        <span class="text-xs font-bold text-green-600 uppercase">AI √ñNERƒ∞Sƒ∞ ü§ñ</span>
    </div>
    <h3 id="aiSuggestionTitle" class="text-xl font-bold text-gray-800">Analiz Ediliyor...</h3>
    
    <p id="aiSuggestionDesc" class="text-sm text-gray-600 mt-1">
        Veriler i≈üleniyor...
    </p>
</div>

<div class="mb-5 border-b pb-4">
    <label class="block text-gray-700 text-sm font-bold mb-2">üéØ Hangi Kitleye Odaklanƒ±yoruz? (6-12 Ay)</label>
    <select id="dbCustomerType" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="updateStrategy()">
        <option value="1">√ñƒürenci (Sƒ±nav & Bilim Kurgu)</option>
        <option value="2">Beyaz Yakalƒ± (ƒ∞≈ü & Ki≈üisel Geli≈üim)</option>
        <option value="3">Kitap Kurdu (Klasikler & Tarih)</option>
        <option value="4">Turist/Gezgin (Rehber & Dil)</option>
        <option value="5">Ebeveyn/√áocuk (Masal & Eƒüitim)</option>
    </select>
</div>

<div id="marketingControls" class="space-y-6 mt-4">
    
    <div>
        <div class="flex justify-between items-center mb-1">
            <label id="lblCh1" class="text-xs font-bold text-gray-700">Y√ºkleniyor...</label>
            <span id="valCh1" class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">‚Ç∫0</span>
        </div>
        <input type="range" id="sliderCh1" min="0" max="50000" step="500" value="0" 
               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
               oninput="calculateResults()">
        <p id="descCh1" class="text-[10px] text-gray-400 mt-1 italic">...</p>
    </div>

    <div>
        <div class="flex justify-between items-center mb-1">
            <label id="lblCh2" class="text-xs font-bold text-gray-700">Y√ºkleniyor...</label>
            <span id="valCh2" class="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded">‚Ç∫0</span>
        </div>
        <input type="range" id="sliderCh2" min="0" max="25000" step="500" value="0" 
               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600"
               oninput="calculateResults()">
        <p id="descCh2" class="text-[10px] text-gray-400 mt-1 italic">...</p>
    </div>

</div>


                <div class="mt-4 bg-white p-4 rounded border border-slate-200 shadow-sm">
                    <div class="flex justify-between items-center mb-3">
                        <p class="text-[10px] font-bold text-slate-400 uppercase flex items-center gap-1">
                            <i class="fa-regular fa-calendar-check"></i> B√ºt√ße D√∂nemselliƒüi
                        </p>
                        <span id="best-month-text" class="text-[9px] bg-indigo-50 text-indigo-700 px-2 py-0.5 rounded font-bold">...</span>
                    </div>
                    <div class="grid grid-cols-6 gap-1 mb-3" id="months-grid">
                        </div>
                    
                    <div class="bg-indigo-50 p-2 rounded border border-indigo-100 flex items-start gap-2">
                        <i class="fa-solid fa-lightbulb text-indigo-500 text-xs mt-0.5"></i>
                        <div>
                            <p class="text-[9px] font-bold text-indigo-800 uppercase mb-0.5">Stratejik Gerek√ße:</p>
                            <p id="seasonality-reason" class="text-[9px] text-indigo-700 leading-snug">...</p>
                        </div>
                    </div>
                </div>

            </div>

            <div class="lg:col-span-2 flex flex-col gap-6">
                
                <div class="stat-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-slate-800">Senaryo: Pazar Payƒ± Deƒüi≈üimi</h3>
                        <span class="text-[10px] bg-blue-50 text-blue-700 px-2 py-1 rounded font-bold border border-blue-100">6-12 AYLIK PROJEKSƒ∞YON</span>
                    </div>

                    <div class="grid grid-cols-2 gap-12 items-center px-8">
                        <div class="text-center opacity-70 grayscale relative">
                            <p class="text-xs font-bold text-slate-500 mb-2 uppercase">Mevcut Durum</p>
                            <div class="h-[150px] relative flex justify-center"><canvas id="chartBefore"></canvas></div>
                        </div>
                        <div class="text-center relative">
                            <div class="absolute top-1/2 -left-6 transform -translate-y-1/2 -translate-x-1/2 text-slate-300 text-3xl animate-pulse"><i class="fa-solid fa-arrow-right-long"></i></div>
                            <p class="text-xs font-bold text-brand-red mb-2 uppercase">Hedeflenen Durum</p>
                            <div class="h-[170px] relative flex justify-center scale-110 transition-all duration-500"><canvas id="chartAfter"></canvas></div>
                        </div>
                    </div>
                </div>

<div class="mt-6 bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
    <div class="text-xs font-bold text-gray-400 uppercase mb-2">Sim√ºlasyon Sonucu</div>
    
    <div class="flex justify-between mb-1">
        <span class="text-gray-600">Toplam B√ºt√ße:</span>
        <span id="displayCost" class="font-bold text-red-500">‚Ç∫0</span>
    </div>
    
    <div class="flex justify-between mb-3">
        <span class="text-gray-600">Beklenen Ciro:</span>
        <span id="displayRevenue" class="font-bold text-blue-600">‚Ç∫0</span>
    </div>
    
    <div class="border-t pt-2 flex justify-between items-center">
        <span class="font-bold text-gray-800">NET K√ÇR ETKƒ∞Sƒ∞:</span>
        <span id="displayProfit" class="text-xl font-bold text-gray-400">‚Ç∫0</span>
    </div>
</div>

            </div>
        </div>
    </main>

<script>
    let currentBranchData = null;      
    
    const vibrantColors = ['#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'];

    const strategies = {
        "1": { title: "Gen√ßlik Kampanyasƒ± üéì", ch1: { name: "TikTok Viral üéµ", desc: "Z Ku≈üaƒüƒ± eri≈üimi.", roi: 4.2 }, ch2: { name: "Kamp√ºs ƒ∞ndirimi üè∑Ô∏è", desc: "S√ºr√ºmden kazan√ß.", roi: 2.5 } },
        "2": { title: "Profesyonel Vizyon üíº", ch1: { name: "LinkedIn Ads üëî", desc: "Prestij odaklƒ± reklam.", roi: 5.5 }, ch2: { name: "E-Posta B√ºlteni üìß", desc: "Sadƒ±k m√º≈üteri kitlesi.", roi: 3.0 } },
        "3": { title: "Edebiyat Tutkusu üìö", ch1: { name: "Podcast Sponsorluƒüu üéôÔ∏è", desc: "Ni≈ü kitleye eri≈üim.", roi: 4.0 }, ch2: { name: "Yazar S√∂yle≈üisi ‚úíÔ∏è", desc: "Topluluk olu≈üturma.", roi: 3.2 } },
        "4": { title: "Global Ke≈üif üåç", ch1: { name: "TripAdvisor Ads üó∫Ô∏è", desc: "Konum bazlƒ± turist √ßekme.", roi: 4.8 }, ch2: { name: "Rehber ƒ∞≈übirliƒüi ü§ù", desc: "Yabancƒ± dil kitap satƒ±≈üƒ±.", roi: 2.8 } },
        "5": { title: "Aile Saati üë®‚Äçüë©‚Äçüëß", ch1: { name: "Instagram / Parents üì∏", desc: "Ebeveyn hedefli g√∂rsel.", roi: 3.8 }, ch2: { name: "Masal At√∂lyesi üé®", desc: "Maƒüaza i√ßi etkinlik.", roi: 3.5 } }
    };

    const segmentNameMap = { "√ñƒürenci": "1", "Beyaz Yakalƒ±": "2", "Kitap Kurdu": "3", "Turist": "4", "Ebeveyn": "5", "√áocuk": "5", "Aile": "5" };

    const commonOpts = { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false } } };
    
    let chartBefore = new Chart(document.getElementById('chartBefore'), { type: 'doughnut', data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] }, options: commonOpts });
    let chartAfter = new Chart(document.getElementById('chartAfter'), { type: 'doughnut', data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] }, options: commonOpts });

    document.addEventListener("DOMContentLoaded", () => {
        const branchDropdown = document.getElementById('branchSelect');
        if(branchDropdown) {
            fetch('/api/subeler').then(res => res.json()).then(data => {
                branchDropdown.innerHTML = '<option value="" disabled selected>Bir ≈ûube Se√ßiniz</option>';
                data.forEach(sube => {
                    const opt = document.createElement('option');
                    opt.value = sube.sube_id;
                    opt.textContent = sube.sube_adi;
                    branchDropdown.appendChild(opt);
                });
            });
        }
        const targetDropdown = document.getElementById('dbCustomerType');
        if(targetDropdown) targetDropdown.addEventListener('change', updateMarketingMix);
    });

    function analyzeBranch() {
        const branchId = document.getElementById('branchSelect').value;
        if(!branchId) return;

        document.getElementById('aiSuggestionTitle').innerHTML = 'Analiz Ediliyor... <span class="animate-pulse">‚è≥</span>';
        resetSliders();

        fetch(`/api/pazarlama-analiz/${branchId}`)
            .then(res => res.json())
            .then(data => {
                if (!data || !data.segments) {
                    console.warn("Sim√ºlasyon Modu Aktif");
                    data = simulateData(branchId);
                } else {
                    if(!Array.isArray(data.segments)) {
                        data = {
                            segments: [
                                { name: "Beyaz Yakalƒ±", share: parseInt(data.beyaz_yakali || data.data?.beyaz_yakali) || 0 },
                                { name: "√ñƒürenci", share: parseInt(data.ogrenci || data.data?.ogrenci) || 0 },
                                { name: "Ebeveyn", share: parseInt(data.ebeveyn || data.data?.ebeveyn) || 0 },
                                { name: "Kitap Kurdu", share: parseInt(data.kitap_kurdu || data.data?.kitap_kurdu) || 0 }
                            ],
                            seasonality: data.seasonality || Array.from({length: 12}, () => Math.random())
                        };
                    }
                }

                data.segments.forEach((seg, index) => {
                    seg.color = vibrantColors[index % vibrantColors.length];
                });
                
                currentBranchData = data;

                processAnalysis(data); 
                renderSeasonality(data.seasonality); 
                initCharts(data.segments); 
                runAiEngine(data.segments); 
            })
            .catch(err => console.error("Analiz Hatasƒ±:", err));
    }

    function processAnalysis(data) {
        const segContainer = document.getElementById('segments-container');
        if(!segContainer) return;
        segContainer.innerHTML = '';
        
        data.segments.forEach(seg => {
            segContainer.innerHTML += `
                <div class="mb-3">
                    <div class="flex justify-between text-xs mb-1">
                        <span class="font-bold" style="color:${seg.color}">${seg.name}</span>
                        <span class="font-bold text-slate-500">%${seg.share}</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-2">
                        <div class="h-2 rounded-full transition-all duration-1000" style="width: ${seg.share}%; background-color: ${seg.color}"></div>
                    </div>
                </div>`;
        });
    }

    function runAiEngine(segments) {
        let sortedSegments = [...segments].sort((a, b) => b.share - a.share);
        let targetSegment = sortedSegments.length > 1 ? sortedSegments[1] : sortedSegments[0];

        let title = "", desc = "";
        if (targetSegment.name.includes('Beyaz')) {
            title = "Profesyonel Vizyon üíº";
            desc = `≈ûubede Beyaz Yakalƒ± segmenti (%${targetSegment.share}) potansiyel ta≈üƒ±yor. ƒ∞≈ü √ßƒ±kƒ±≈üƒ± saatlerine odaklanarak %35 b√ºy√ºme fƒ±rsatƒ± var.`;
        } else if (targetSegment.name.includes('√ñƒürenci')) {
            title = "Gen√ß Enerji üéì";
            desc = `√ñƒürenci kitlesi (%${targetSegment.share}) y√ºkseli≈üte. Sƒ±nav d√∂nemlerine √∂zel kampanyalarla bu grubu lider konuma ta≈üƒ±yabilirsiniz.`;
        } else if (targetSegment.name.includes('Ebeveyn') || targetSegment.name.includes('Aile')) {
            title = "Aile Odaklƒ± B√ºy√ºme üë®‚Äçüë©‚Äçüëß‚Äçüë¶";
            desc = `Aile kitlesi (%${targetSegment.share}) sadƒ±k m√º≈üteri olmaya aday. Hafta sonu √ßocuk etkinlikleri ile ciro artƒ±rƒ±labilir.`;
        } else {
            title = "K√ºlt√ºr Ka≈üifleri üìö";
            desc = `Okuyucu kitlesi (%${targetSegment.share}) artƒ±≈ü trendinde. ƒ∞mza g√ºnleri ile bu kitleyi ana gelir kaynaƒüƒ± yapƒ±n.`;
        }

        const titleEl = document.getElementById('aiSuggestionTitle');
        const descEl = document.getElementById('aiSuggestionDesc');
        if(titleEl) {
            titleEl.className = "text-xl font-bold text-green-800 transition-all duration-500";
            titleEl.innerHTML = `√ñNERƒ∞LEN: ${title}`;
        }
        if(descEl) descEl.innerText = desc;

        const dropdown = document.getElementById('dbCustomerType');
        if(dropdown) {
            let foundID = null;
            for (const [key, value] of Object.entries(segmentNameMap)) {
                if (targetSegment.name.includes(key)) { foundID = value; break; }
            }
            if(foundID) {
                dropdown.value = foundID;
                updateMarketingMix();
            }
        }
    }

    function updateMarketingMix() {
        const dropdown = document.getElementById('dbCustomerType');
        if(!dropdown) return;
        const data = strategies[dropdown.value];
        if (!data) return;

        if(document.getElementById('lblCh1')) document.getElementById('lblCh1').innerText = data.ch1.name;
        if(document.getElementById('descCh1')) document.getElementById('descCh1').innerText = data.ch1.desc;
        if(document.getElementById('lblCh2')) document.getElementById('lblCh2').innerText = data.ch2.name;
        if(document.getElementById('descCh2')) document.getElementById('descCh2').innerText = data.ch2.desc;
        
        resetSliders();
    }

    window.calculateResults = function() {
        const dropdown = document.getElementById('dbCustomerType');
        const data = strategies[dropdown.value];
        const val1 = parseInt(document.getElementById('sliderCh1').value) || 0;
        const val2 = parseInt(document.getElementById('sliderCh2').value) || 0;

        document.getElementById('valCh1').innerText = '‚Ç∫' + val1.toLocaleString();
        document.getElementById('valCh2').innerText = '‚Ç∫' + val2.toLocaleString();

        const cost = val1 + val2;
        const revenue = (val1 * data.ch1.roi) + (val2 * data.ch2.roi);
        const profit = revenue - cost;

        if(document.getElementById('displayCost')) document.getElementById('displayCost').innerText = '‚Ç∫' + cost.toLocaleString();
        if(document.getElementById('displayRevenue')) document.getElementById('displayRevenue').innerText = '‚Ç∫' + Math.round(revenue).toLocaleString();
        const profitEl = document.getElementById('displayProfit');
        if(profitEl) {
            profitEl.innerText = (profit > 0 ? '+' : '') + '‚Ç∫' + Math.round(profit).toLocaleString();
            profitEl.className = profit >= 0 ? "text-3xl font-extrabold text-green-600" : "text-3xl font-extrabold text-red-600";
        }

        updateChartVisuals(dropdown.value, cost);
    }

    function updateChartVisuals(targetTypeID, totalBudget) {
        if(!chartAfter || !currentBranchData) return;
        const boostAmount = totalBudget / 1500;
        let newData = currentBranchData.segments.map(s => s.share);
        
        let targetName = "";
        for (const [key, value] of Object.entries(segmentNameMap)) {
            if (value === targetTypeID) targetName = key;
        }

        let targetIndex = currentBranchData.segments.findIndex(s => s.name.includes(targetName));
        if(targetIndex === -1) targetIndex = 0;

        newData[targetIndex] += boostAmount;
        const totalShare = newData.reduce((a, b) => a + b, 0);
        const normalizedData = newData.map(val => (val / totalShare) * 100);

        chartAfter.data.datasets[0].data = normalizedData;
        chartAfter.update('none');
    }

    function initCharts(segments) {
        const labels = segments.map(s => s.name);
        const data = segments.map(s => s.share);
        const colors = segments.map(s => s.color); 

        chartBefore.data.labels = labels;
        chartBefore.data.datasets[0].data = [...data];
        chartBefore.data.datasets[0].backgroundColor = colors;
        chartBefore.update();

        chartAfter.data.labels = labels;
        chartAfter.data.datasets[0].data = [...data];
        chartAfter.data.datasets[0].backgroundColor = colors; 
        chartAfter.update();
    }

    function renderSeasonality(heatmapData) {
        const container = document.getElementById('months-grid');
        if(!container) return;
        container.innerHTML = '';
        const months = ['Oca', '≈ûub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Aƒüu', 'Eyl', 'Eki', 'Kas', 'Ara'];
        const data = (heatmapData && heatmapData.length === 12) ? heatmapData : new Array(12).fill(0.1);
        
        let maxVal = 0; let maxIndex = 0;
        data.forEach((val, idx) => { if(val > maxVal) { maxVal = val; maxIndex = idx; } });
        if(document.getElementById('best-month-text')) document.getElementById('best-month-text').innerText = `${months[maxIndex]} D√∂nemi Odaklƒ±`;

        data.forEach((val, i) => {
            let opacity = val || 0.1;
            let bgColor = opacity < 0.2 ? '#f8fafc' : `rgba(16, 185, 129, ${opacity})`; 
            let textColor = opacity > 0.5 ? 'white' : '#64748b';
            container.innerHTML += `<div class="h-8 rounded flex items-center justify-center text-[9px] font-bold border border-slate-100" style="background-color: ${bgColor}; color: ${textColor};">${months[i]}</div>`;
        });
    }

    function resetSliders() {
        if(document.getElementById('sliderCh1')) document.getElementById('sliderCh1').value = 0;
        if(document.getElementById('sliderCh2')) document.getElementById('sliderCh2').value = 0;
        calculateResults();
    }

    function simulateData(branchId) {
        const seed = parseInt(branchId) * 11;
        return {
            segments: [
                { name: "Beyaz Yakalƒ±", share: (seed % 35) + 15 },
                { name: "√ñƒürenci", share: ((seed + 20) % 30) + 10 },
                { name: "Ebeveyn", share: ((seed + 40) % 25) + 5 },
                { name: "Kitap Kurdu", share: 20 }
            ],
            seasonality: Array.from({length: 12}, () => Math.random())
        };
    }
</script>
</body>
</html>